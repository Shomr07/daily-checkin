<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Daily Check-In</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: -apple-system, system-ui;
      background:#0f172a;
      color:#e5e7eb;
      padding:20px;
    }
    .box {
      max-width:420px;
      margin:auto;
      background:#020617;
      padding:22px;
      border-radius:18px;
    }
    h2 { margin-top:0 }
    button {
      width:100%;
      padding:16px;
      margin:10px 0;
      border-radius:14px;
      border:none;
      font-size:16px;
      cursor:pointer;
    }
    .primary { background:#2563eb; color:white }
    .green { background:#16a34a; color:#052e16 }
    .red { background:#ef4444; color:#450a0a }
    .disabled { opacity:.5; pointer-events:none }
    .msg { margin-top:6px; font-size:14px; opacity:.85 }
    .hidden { display:none }
    .subtle { opacity:.75; font-size:14px }
  </style>
</head>

<body>

<!-- HOME -->
<div class="box" id="home">
  <h2>Welcome back, Shom</h2>
  <div class="subtle" id="date"></div>

  <button class="primary" onclick="goCheckin()">Mark Today</button>
  <button onclick="goProgress()">Check Progress</button>
</div>

<!-- CHECK-IN -->
<div class="box hidden" id="checkin">
  <h2>Daily Check-In</h2>

  <p><b>Shmiras HaBris</b></p>
  <button class="green" onclick="answer('bris',true)">I overcame my urge</button>
  <button class="red" onclick="answer('bris',false)">I fell today</button>
  <div id="bris-msg" class="msg"></div>

  <p style="margin-top:16px"><b>Shmiras Einayim</b></p>
  <button class="green" onclick="answer('ein',true)">I overcame my urge</button>
  <button class="red" onclick="answer('ein',false)">I fell today</button>
  <div id="ein-msg" class="msg"></div>
</div>

<!-- PROGRESS -->
<div class="box hidden" id="progress">
  <h2>Your Progress</h2>
  <p id="points"></p>
  <p id="streak"></p>
  <p class="subtle">Consistency builds strength.</p>

  <button onclick="goHome()">Back Home</button>
</div>

<script>
  const todayKey = () => new Date().toISOString().slice(0,10);

  const state = JSON.parse(localStorage.getItem('state') || '{}');
  const today = todayKey();

  state.days ||= {};
  state.points ||= 0;
  state.streak ||= 0;
  state.lastLogged ||= null;

  let answers = state.days[today] || { bris:null, ein:null };

  function show(id){
    ['home','checkin','progress'].forEach(s =>
      document.getElementById(s).classList.add('hidden')
    );
    document.getElementById(id).classList.remove('hidden');
  }

  function goHome(){ show('home') }
  function goCheckin(){ show('checkin') }
  function goProgress(){
    document.getElementById('points').innerText = 'Points: ' + state.points;
    document.getElementById('streak').innerText = 'Streak: ' + state.streak + ' days';
    show('progress');
  }

  function answer(which, success){
    if (answers[which] !== null) return;
    answers[which] = success;

    document.getElementById(which + '-msg').innerText =
      success ? 'Well done. One day at a time.' : 'Tomorrow is another day.';

    document.querySelectorAll(
      which === 'bris'
        ? 'button[onclick^="answer(\'bris"]'
        : 'button[onclick^="answer(\'ein"]'
    ).forEach(b => b.classList.add('disabled'));

    if (answers.bris !== null && answers.ein !== null) finishDay();
  }

  function finishDay(){
    if (!state.days[today]) {
      if (answers.bris) state.points += 10;
      if (answers.ein) state.points += 10;
      state.points += 5;

      if (state.lastLogged) {
        const diff =
          (new Date(today) - new Date(state.lastLogged)) / 86400000;
        state.streak = diff === 1 ? state.streak + 1 : 1;
      } else {
        state.streak = 1;
      }

      state.lastLogged = today;
    }

    state.days[today] = answers;
    localStorage.setItem('state', JSON.stringify(state));
    goProgress();
  }

  // restore if already logged today
  if (state.days[today]) {
    answers = state.days[today];
  }
</script>

</body>
</html>
